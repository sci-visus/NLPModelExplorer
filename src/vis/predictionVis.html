<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Text Entailment Prediction</title>
    <style>

        body {
            font: 10px sans-serif;
        }

        h2 {
            color: grey;
        }

        .label {
            fill: black;
            font-size: small;
            /*font-weight: bolder;*/
        }
        .trilabel {
            fill: black;
            font-size: large;
        }

    </style>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="data.js"></script>
</head>

<body>


<h2>Text Entailment Prediction</h2>
<div id="predContainer">
    <svg width="400" height="300">
        <defs>
          <linearGradient id="fadeA-1" gradientUnits="userSpaceOnUse" x1="30.000000" y1="330.000000" x2="30.000000" y2="30.000000">
            <stop offset="0%" stop-color="#FF0000"/>
            <stop offset="100%" stop-color="#000000" />
          </linearGradient>
          <linearGradient id="fadeB-1" gradientUnits="userSpaceOnUse" x1="330.000000" y1="30.00000" x2="135.000000" y2="30.000000">
            <stop offset="0%" stop-color="#00FF00"/>
            <stop offset="100%" stop-color="#000000" />
          </linearGradient>
          <linearGradient id="fadeC-1" gradientUnits="userSpaceOnUse" x1="180.000000" y1="260.00000" x2="30.000000" y2="30.000000">
            <stop offset="0%" stop-color="#0000FF"/>
            <stop offset="100%" stop-color="#000000" />
          </linearGradient>

          <path id="pathA-1" d="M 30.000000,30.000000 L 330.000000,30.00000 180.000000,260.00000 Z" fill="url(#fadeA-1)"/>
          <path id="pathB-1" d="M 30.000000,30.000000 L 330.000000,30.00000 180.000000,260.00000 Z" fill="url(#fadeB-1)"/>
          <filter id="Default">
            <feImage xlink:href="#pathA-1" result="layerA" x="0" y="0" />
            <feImage xlink:href="#pathB-1" result="layerB" x="0" y="0" />
            <feComposite in="layerA" in2="layerB" operator="arithmetic" k1="0" k2="1.0" k3="1.0" k4="0" result="temp"/>
            <feComposite in="temp" in2="SourceGraphic"   operator="arithmetic" k1="0" k2="1.0" k3="1.0" k4="0"/>
          </filter>
        </defs>
        <!-- <g stroke="none" stroke-width="0" shape-rendering="crispEdges" > -->
        <path d="M 30.000000,30.000000 L 330.000000,30.00000 180.000000,260.00000 Z" fill="url(#fadeC-1)" filter="url(#Default)" />
        <!-- </g> -->
    </svg>
</div>
<div id = "textContainer">
    <select id="sList" style="max-width:200px; top:20px">
    </select>
    <select id="tList" style="max-width:200px; top:20px">
    </select>
    <div id="textPair">
    </div>
</div>


<!-- <script src="data2.js"></script> -->
<script>
console.log(sdata);
var htmlList = "";
for (var i = 0; i < sdata.length; i++) {
    if (i === 0)
        htmlList += "<option value=" + i + " selected>" + sdata[i].src +
        "</option>";
    else
        htmlList += "<option value=" + i + ">" + sdata[i].src +
        "</option>";
}

// var triangleSVG = ""

d3.select("#sList").html(htmlList).on('change', d=>{updateData(sdata, Number(d3.select("#sList").node().value)); });

const margin = {top: 0, right: 0, bottom: 0, left: 0};

  const svg = d3.select("svg").attr("border", "None");
  const width = +svg.attr("width") - margin.left - margin.right;
  const height = +svg.attr("height") - margin.top - margin.bottom;

  // illustrate left/right margins
  const xScale = d3.scaleLinear()
    .domain([margin.left, margin.left + width])
    .range([0, width]);


  // illustrate top/bottom margins
  const yScale = d3.scaleLinear()
    .domain([margin.top, margin.top + height])
    .range([0, height]);

  const label = svg.append("g")
    .attr("class", "label");

  var trianglePoints = xScale(30) + ' ' + yScale(30) + ', '
                      + xScale(330) + ' ' + yScale(30) + ', '
                      + xScale(180) + ' ' + yScale(260);

  //entailment
  const trilabel = svg.append("g");
  trilabel.append('text')
  .attr("class", "trilabel")
  .attr("x", xScale(15))
  .attr("y", yScale(20))
  .text("entailment");

  //neutral
  trilabel.append('text')
  .attr("class", "trilabel")
  .attr("x", xScale(315))
  .attr("y", yScale(20))
  .text("neutral");

  //contradiction
  trilabel.append('text')
  .attr("class", "trilabel")
  .attr("x", xScale(155))
  .attr("y", yScale(280))
  .text("contradiction");

  // svg.append('polyline')
  //     .attr('points', trianglePoints)
  //     .style('fill', 'grey')
  //     .style('stroke', 'None');

  updateData(sdata, 0);

  function updateData(sdata, sIndex){
    var data = [sdata[sIndex]["src"], sdata[sIndex]["targ"][0], sdata[sIndex]["targ"][0]];

    svg.selectAll("circle").remove();
      svg.selectAll("circle")
      .data(sdata[sIndex]["pred"])
      .enter()
      .append("circle")
      .attr("id", (d,i)=> {return "circle"+i;})
      .attr("cx", d=>{return xScale(d["entailment"]*30+d["neutral"]*330+d["contradiction"]*180) } )
      .attr("cy", d=>{return yScale(d["entailment"]*30+d["neutral"]*30+d["contradiction"]*260) })
      .attr("r", (d,i)=>{if (i==0) return 6; else return 3;})
      .style("fill", (d,i)=>{if (i==0) return 'red'; else return 'white';})
      .style("stroke", 'black')
      .style("opacity", 0.7)
    //   .style("opacity", (d,i)=>{if (i==0) return "1.0"; else return "0.5";})
      .on("mouseover", (d,i)=>{
          var data = [sdata[sIndex]["src"], sdata[sIndex]["targ"][i], sdata[sIndex]["targ"][0]];
          updateLabel(data, i);
      });
      updateTargetList(sdata[sIndex]["targ"], sIndex);
      updateLabel(data, 0);
  }
  function updateTargetList(data, sIndex){
      var htmlList = '';
      for(var i=0; i<data.length; i++){
          if (i === 0)
              htmlList += "<option value=" + i + " selected>" + data[i] +
              "</option>";
          else
              htmlList += "<option value=" + i + ">" + data[i] +
              "</option>";
      }

      // console.log(texthtml);
      d3.select("#tList").html(htmlList);
      d3.select("#tList").html(htmlList).on('change', d=>{
          var index = Number(d3.select("#tList").node().value);
          updateLabel([sdata[sIndex]["src"],sdata[sIndex]["targ"][index], sdata[sIndex]["targ"][0]], index);
      });
  }

  function updateLabel(data, index){
      var texthtml='<p class=\'label\'>' + "Source: "+ data[0] + '</p>\n';
      if( data[2] != data[1])
        texthtml += '<p class=\'label\'>' + "Perturbed (Target): "+ data[1] + '</p>';
      texthtml += '<p class=\'label\'>' + "Target: "+ data[2] + '</p>\n';
      // console.log(texthtml);
      d3.select("#textPair").html(texthtml);

      svg.selectAll("circle")
         .attr("r", 3)
         .style("fill", "white");

      svg.select("#circle"+index)
        .attr("r", 6)
        .style("fill", "red");

    //   label.selectAll(".label").remove();
    //   label.selectAll(".label")
    // .data(data)
    // .enter()
    // .append("text")
    // .attr("class", "label")
    // .text(d => d)
    // .attr("x", 10)
    // .attr("y", (d, i) => height * 0.8 + (i * 25))
    // .attr("text-anchor", "left");
    }

</script>

</body>

</html>
